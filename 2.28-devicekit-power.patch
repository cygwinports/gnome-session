--- origsrc/gnome-session-2.28.0/configure.in	2009-09-08 19:21:06.000000000 -0500
+++ src/gnome-session-2.28.0/configure.in	2009-11-01 02:20:09.259630100 -0600
@@ -53,9 +53,17 @@ PKG_CHECK_MODULES(GNOME_SESSION,
         gio-2.0 >= $GLIB_REQUIRED
         gtk+-2.0 >= $GTK_REQUIRED
         dbus-glib-1 >= $DBUS_GLIB_REQUIRED
-        devkit-power-gobject >= $DEVKIT_POWER_REQUIRED
 )
 
+PKG_CHECK_MODULES(DEVKIT_POWER,
+        devkit-power-gobject >= $DEVKIT_POWER_REQUIRED,
+        have_devkit_power=true,
+        have_devkit_power=false
+)
+if test "$have_devkit_power" = true; then
+  AC_DEFINE(WITH_DEVKIT_POWER, 1, [Set to 1 if devkit-power-gobject is available.])
+fi
+
 PKG_CHECK_MODULES(SESSION_PROPERTIES,
         glib-2.0 >= $GLIB_REQUIRED
         gtk+-2.0 >= $GTK_REQUIRED
--- origsrc/gnome-session-2.28.0/gnome-session/gsm-logout-dialog.c	2009-08-25 03:03:42.000000000 -0500
+++ src/gnome-session-2.28.0/gnome-session/gsm-logout-dialog.c	2009-11-01 02:15:14.949516900 -0600
@@ -27,7 +27,9 @@
 #include <glib/gi18n.h>
 #include <gtk/gtk.h>
 
+#ifdef WITH_DEVKIT_POWER
 #include <devkit-power-gobject/devicekit-power.h>
+#endif
 
 #include "gsm-logout-dialog.h"
 #include "gsm-consolekit.h"
@@ -50,7 +52,9 @@ struct _GsmLogoutDialogPrivate
 {
         GsmDialogLogoutType  type;
 
+#ifdef WITH_DEVKIT_POWER
         DkpClient           *dkp_client;
+#endif
         GsmConsolekit       *consolekit;
 
         int                  timeout;
@@ -142,7 +146,9 @@ gsm_logout_dialog_init (GsmLogoutDialog 
         gtk_window_set_keep_above (GTK_WINDOW (logout_dialog), TRUE);
         gtk_window_stick (GTK_WINDOW (logout_dialog));
 
+#ifdef WITH_DEVKIT_POWER
         logout_dialog->priv->dkp_client = dkp_client_new ();
+#endif
 
         logout_dialog->priv->consolekit = gsm_get_consolekit ();
 
@@ -166,10 +172,12 @@ gsm_logout_dialog_destroy (GsmLogoutDial
                 logout_dialog->priv->timeout_id = 0;
         }
 
+#ifdef WITH_DEVKIT_POWER
         if (logout_dialog->priv->dkp_client) {
                 g_object_unref (logout_dialog->priv->dkp_client);
                 logout_dialog->priv->dkp_client = NULL;
         }
+#endif
 
         if (logout_dialog->priv->consolekit) {
                 g_object_unref (logout_dialog->priv->consolekit);
@@ -182,21 +190,29 @@ gsm_logout_dialog_destroy (GsmLogoutDial
 static gboolean
 gsm_logout_supports_system_suspend (GsmLogoutDialog *logout_dialog)
 {
+#ifdef WITH_DEVKIT_POWER
         gboolean ret;
         g_object_get (logout_dialog->priv->dkp_client,
                       "can-suspend", &ret,
                       NULL);
         return ret;
+#else
+        return FALSE;
+#endif
 }
 
 static gboolean
 gsm_logout_supports_system_hibernate (GsmLogoutDialog *logout_dialog)
 {
+#ifdef WITH_DEVKIT_POWER
         gboolean ret;
         g_object_get (logout_dialog->priv->dkp_client,
                       "can-hibernate", &ret,
                       NULL);
         return ret;
+#else
+        return FALSE;
+#endif
 }
 
 static gboolean
--- origsrc/gnome-session-2.28.0/gnome-session/gsm-manager.c	2009-09-18 11:36:04.000000000 -0500
+++ src/gnome-session-2.28.0/gnome-session/gsm-manager.c	2009-11-01 02:28:48.210134900 -0600
@@ -38,7 +38,9 @@
 #include <dbus/dbus-glib.h>
 #include <dbus/dbus-glib-lowlevel.h>
 
+#ifdef WITH_DEVKIT_POWER
 #include <devkit-power-gobject/devicekit-power.h>
+#endif
 
 #include <gtk/gtk.h> /* for logout dialog */
 #include <gconf/gconf-client.h>
@@ -134,8 +136,10 @@ struct GsmManagerPrivate
         DBusGProxy             *bus_proxy;
         DBusGConnection        *connection;
 
+#ifdef WITH_DEVKIT_POWER
         /* Interface with other parts of the system */
         DkpClient              *dkp_client;
+#endif
 };
 
 enum {
@@ -971,6 +975,7 @@ manager_perhaps_lock (GsmManager *manage
 static void
 manager_attempt_hibernate (GsmManager *manager)
 {
+#ifdef WITH_DEVKIT_POWER
         gboolean  can_hibernate;
         GError   *error;
         gboolean  ret;
@@ -992,11 +997,13 @@ manager_attempt_hibernate (GsmManager *m
                         g_error_free (error);
                 }
         }
+#endif
 }
 
 static void
 manager_attempt_suspend (GsmManager *manager)
 {
+#ifdef WITH_DEVKIT_POWER
         gboolean  can_suspend;
         GError   *error;
         gboolean  ret;
@@ -1018,6 +1025,7 @@ manager_attempt_suspend (GsmManager *man
                         g_error_free (error);
                 }
         }
+#endif
 }
 
 static void
@@ -2190,10 +2198,12 @@ gsm_manager_dispose (GObject *object)
                 manager->priv->gconf_client = NULL;
         }
 
+#ifdef WITH_DEVKIT_POWER
         if (manager->priv->dkp_client != NULL) {
                 g_object_unref (manager->priv->dkp_client);
                 manager->priv->dkp_client = NULL;
         }
+#endif
 
         G_OBJECT_CLASS (gsm_manager_parent_class)->dispose (object);
 }
@@ -2423,7 +2433,9 @@ gsm_manager_init (GsmManager *manager)
                           G_CALLBACK (on_presence_status_changed),
                           manager);
 
+#ifdef WITH_DEVKIT_POWER
         manager->priv->dkp_client = dkp_client_new ();
+#endif
 
         /* GConf setup */
         gconf_client_add_dir (manager->priv->gconf_client,
@@ -2947,10 +2959,15 @@ gsm_manager_can_shutdown (GsmManager *ma
         gboolean can_suspend;
         gboolean can_hibernate;
 
+#ifdef WITH_DEVKIT_POWER
         g_object_get (manager->priv->dkp_client,
                       "can-suspend", &can_suspend,
                       "can-hibernate", &can_hibernate,
                       NULL);
+#else
+        can_suspend = FALSE;
+        can_hibernate = FALSE;
+#endif
 
         g_debug ("GsmManager: CanShutdown called");
 
